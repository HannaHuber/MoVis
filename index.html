<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <title>MoVis</title>
    <script type="text/javascript" src="http://mbostock.github.io/d3/d3.js"></script>
    <link rel="stylesheet" href="css/movis.css">
</head>

    <body>
    <h1 align="center" style="color:steelblue;">MoVis</h1>
    <p align="center" class=subtitle" style="color:steelblue;">Movie Society Visualizer</p>

    <div align="right" class="dropdown">
        <p id="filterYear" style="color:steelblue;">Year
            <select align="right" id="dropdownYear" onchange="updateFilter()">
                <option value="all">All</option>
            </select>
        </p>
        <p id="filterGenre" style="color:steelblue;">Genre
            <select align="right"id="dropdownGenre" onchange="updateFilter()">
                <option value="all">All</option>
            </select>
        </p>
        <p id="filterGender" style="color:steelblue;">Gender
            <select align="right"id="dropdownGender" onchange="updateFilter()">
                <option value="all">All</option>
                <option value="f">Female</option>
                <option value="m">Male</option>
                <option value="cmp">Female vs. Male</option>
            </select>
        </p>
        <p id="average"style="color:steelblue;">Average
            <input type="checkbox" name="checkbox" id="checkboxAverage" value="FALSE" onclick="updateFilter()">
        </p>
    </div>

    <svg width="960" height="500"></svg>

    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-collection.v1.min.js"></script>
    <script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-request.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>
    
    <script src="https://d3js.org/d3-array.v1.min.js"></script>
    <script src="https://d3js.org/d3-collection.v1.min.js"></script>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-format.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>


    <script src="https://d3js.org/d3-scale.v1.min.js"></script>
    <script src="https://d3js.org/d3-axis.v1.min.js"></script>
    <script src="https://d3js.org/d3-path.v1.min.js"></script>
    <script src="https://d3js.org/d3-shape.v1.min.js"></script>






    <script src="https://d3js.org/d3-selection.v1.min.js"></script>
  <script src="https://d3js.org/d3-ease.v1.min.js"></script>
   <script src="https://d3js.org/d3-timer.v1.min.js"></script>
   <script src="https://d3js.org/d3-transition.v1.min.js"></script> <!---->




    <!--<style>
               .line {
            fill: none;
            stroke: steelblue;
            stroke-opacity: 0.1;
            stroke-width: 0.5px;
        }
    </style>-->


    <!--<script >



        /*svgLine svg = d3.selesvgLine"svg"),
        margin = { top: 20, right: 80, bottom: 30, left: 50 },
        widtsvgLine svg.attr("width") - margin.left - margin.right,
        heighsvgLine svg.attr("height") - margin.top - margin.bottom,
        svgLine svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scaleLinear().svgLinege([0, width]),
            y = d3.scaleLinear().range([height, 0]),
            z = 0.1;//d3.scaleOrdinal(d3.schemeCategory10);

        var line = d3.line()
                    .curve(d3.curveLinear)
                    .x(function (d) { return x(d.age); })
                    .y(function (d) { return y(d.density); });

        


        function parseAge(data, _, columns) {
  svgLine       data.age = +data.age;
            for (var i = 1, t = 0, c; i < columns.length; ++i) {
                data[c = columns[i]] =  +data[c]
            }
            return data;
        }

        function parseInfo(data, _, columns) {
            data.year = +data.year;
            data["title"] = data["title"];
            data["genres"] = data["genres"]
            return data;
        }
        
        function draw(error,  o_m, bt) {
            if (error) { console.log(error); }

            
            console.log(o_m[0]);
            //console.log(bt[0]);
            

            var origins = o_m.columns.slice(1,100).map(function (id) {
                return {
                    id: id,
                    values: o_m.map(function (d) {
                        return { age: d.age, density: d[id]/d3.sum(o_m,function(d){return d[id]}) };
                    })
                };
            });

            //var origins = all_origins.filter(function(o){return o[id]%7==0});

            x.domain(d3.extent(o_m, function (d) { return d.age; }));

            y.domain([
              d3.min(origins, function (c) { return d3.min(c.values, function (d) { return d.density; }); }),
              d3.max(origins, function (c) { return d3.max(c.values, function (d) { return d.density; }); })
            ]);

           
            g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
     .call(d3.svg.axis().scale(x).orient("bottom"))
                .append("text")
                .attr("transform",
                    "translate(" + (width/2) + " ," +
                    (height + margin.top ) + ")")
                .style("text-anchor", "middle")
                .text("Age");

            g.append("g")
                .attr("class", "axis axis--y")
                .call(d3.svg.axis().scale(y).orient("left"))
              .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x",0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Density");

            var city = g.selectAll(".city")
                .data(origins)
                .enter().append("g")
                .filter(function(o){return o.id%50==0})
                .attr("class", "city");

            city.append("path")
                .attr("class", "line")
                .attr("d", function (d) { return line(d.values); })
                //.style("stroke-opacity", function (d) { return z(d.id); })
                .on("mouseout", function(){d3.select(this).style({"stroke-opacity":"0.1","stroke-width":"0.5px"});})
                .on("mouseover", function(){d3.select(this).style({"stroke-opacity":"1","stroke-width":"1px"});});



            city.append("text")
                .datum(function (d) { return { id: d.id, value: d.values[d.values.length - 1] }; })
                .attr("transform", function (d) { return "translate(" + x(d.value.age) + "," + y(d.value.density) + ")"; })
                .attr("x", 3)
                .attr("dy", "0.35em")
                .style("font", "10px sans-serif")
                .text(function (d) { return d.id; });
            /!*g.append("path")
                .datum(origins)
      .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 1.5)
      .attr("d", line);*!/
        }

        function readDSV(file, access) {
            d3.request(file)
                //.mimeType("text/plain")
                .response(function(xhr) {return d3.dsvFormat(";").parse(xhr.responseText,access )})
                .get(draw);
        }

        d3.request("./data/pdf/age_all_id_1-15k.csv")
            .mimeType("text/plain")
            .response(function(xhr) {return d3.dsvFormat(";").parse(xhr.responseText, parseAge)})
            .get(draw);

        //d3.request("./raw/movie_meta.csv")
         //   .mimeType("text/plain")
         //   .response(function(xhr) {return d3.dsvFormat(";").parse(xhr.responseText, parseInfo

        //d3.queue()
        //   .defer(readDSV, "./data/pdf/age_all_id_1-15k.csv", parseAge)
        //.defer(readDSV, "./data/meta/movie_meta.csv", parseInfo)
            //.awaitAll(draw);



            //.defer(d3.csv,"./data/pdf/age_all_id_1-15k.csv", type)
            //.defer(d3.csv,"./data.csv", type)
            //.defer(d3.csv,"./data/pdf/originDF_all.csv")
  //.defer(d3.csv, "./data/pdf/originDF_m.csv")
  //.defer(d3.csv, "./data/pdf/originDF_f.csv")

  //.defer(d3.csv,"./data/pdf/ageDF_m.csv")        
  //.defer(d3.csv,"./data/pdf/ageDF_f.csv")
//.defer(d3.csv,"./data/pdf/genderDF.csv")
  //.await(analyze);

        
        */
    </script>-->
    <!--<script>


function row(d) {
            for (svgLine i = 1, t = 0,svgLine i < columns.length; ++i) {
                d[c = columns[i]] = c;
            }
           svgLineturn d;
        }
	var ssv = d3.dsvFormat(";");

        function rsvgLined) {
            return {
                Austria: +d.Austria,svgLine              United_States: +d["United States"],
                Ambiguous: d.Ambiguous,
                Unknown: +d.Unknown // convert "Length" column to number
            };
        }

        d3.request("./data/pdf/originDF_all_field_names_c.csv")
        .mimeType("text/plain")
        .response(function(xhr) {return ssv.parse(xhr.responseText, row)})
        .get(function (data) {
            console.log("pipe-delimited data:")
            console.log(data[1]);
        });

        function analyze(error, originDF_m_field_names, originDF_f_field_names) {
            if (error) { console.log(error); }

            console.log(originDF_m_field_names[0]);
            console.log(originDF_f_field_names[0]);
        }

        d3.queue()
  .defer(d3.request("./data/pdf/originDF_m_field_names.csv")
        .mimeType("text/plain")
        .response(function (xhr) { return ssv.parse(xhr.responseText, row) }).get(function (data) {
            console.log("pipe-delimited data:")
            console.log(data[1]);
        }))
  .defer(d3.request("./data/pdf/originDF_f_field_names.csv")
        .mimeType("text/plain")
        .response(function (xhr) { return ssv.parse(xhr.responseText, row) }).get(function (data) {
            console.log("pipe-delimited data:")
            console.log(data[1]);
        }))
  .await(analyze);


        var svg = d3.select("svg"),
            margin = { top: 20, right: 60, bottom: 30, left: 40 },
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scaleBand()
            .rangeRound([0, width])
            .padding(0.1)
            .align(0.1);

        var y = d3.scaleLinear()
            .rangeRound([height, 0]);

        var z = d3.scaleOrdinal()
            .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

        var stack = d3.stack()
            .offset(d3.stackOffsetExpand);

        d3.csv("/data/pdf/ageDF_all_field_names.csv", type, function (error, data) {
            if (error) throw error;

            console.log(data[0]);
            data.sort(function(a, b) { return b[data.columns[1]] / b.total - a[data.columns[1]] / a.total; });

            x.domain(data.map(function(d) { return d.State; }));
            z.domain(data.columns.slice(1));

            var serie = g.selectAll(".serie")
              .data(stack.keys(data.columns.slice(1))(data))
              .enter().append("g")
                .attr("class", "serie")
                .attr("fill", function(d) { return z(d.key); });

            serie.selectAll("rect")
              .data(function(d) { return d; })
              .enter().append("rect")
                .attr("x", function(d) { return x(d.data.State); })
                .attr("y", function(d) { return y(d[1]); })
                .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                .attr("width", x.bandwidth());

            g.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            g.append("g")
                .attr("class", "axis axis--y")
                .call(d3.axisLeft(y).ticks(10, "%"));

            var legend = serie.append("g")
                .attr("class", "legend")
                .attr("transform", function(d) { var d = d[d.length - 1]; return "translate(" + (x(d.data.State) + x.bandwidth()) + "," + ((y(d[0]) + y(d[1])) / 2) + ")"; });

            legend.append("line")
                .attr("x1", -6)
                .attr("x2", 6)
                .attr("stroke", "#000");

            legend.append("text")
                .attr("x", 9)
                .attr("dy", "0.35em")
                .attr("fill", "#000")
                .style("font", "10px sans-serif")
                .text(function(d) { return d.key; });
        });

        function type(d, i, columns) {
            for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
            d.total = t;
            return d;
        }

    </script>-->



    <script src="js/movis.js"></script>
</body>
</html>